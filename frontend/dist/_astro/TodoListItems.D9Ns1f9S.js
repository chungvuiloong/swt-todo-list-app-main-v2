import{p as fe,m as J,a as E,o as M,d as i,v as Pe,c as V,h as U,g as m,t as h,w as le,i as u,j as R,q as me,s as O,r as H,b as f,S as B,F as ve,x as Te,u as he,y as ee,f as $e,k as Fe}from"./store.BVrLplq6.js";import{N as te}from"./NavItem.DLTxhlF6.js";import{t as oe,a as Ee}from"./todoActions.CcFcA-pD.js";import{u as be}from"./userState.D8IPT1p-.js";import{I as D}from"./iconify.ByqseDuz.js";import{I as Ae,a as se,b as De,c as Me,F as Ne,r as ze,A as ue}from"./FormError.BjAbR7KG.js";import{u as Ue}from"./userActions.dISuq_KV.js";import{d as ce}from"./dialogUtil.C29_IkiY.js";var Re=h("<div>"),je=h("<div class=solid-select-control><!$><!/><!$><!/><!$><!/><!$><!/>"),qe=h("<div class=solid-select-placeholder>"),Be=h("<div class=solid-select-single-value>"),He=h("<div class=solid-select-multi-value><span></span><button type=button class=solid-select-multi-value-remove>тип"),Ke=h("<input class=solid-select-input type=text tabindex=0 autocomplete=off autocapitalize=none autocorrect=off size=1>"),Ge=h("<div class=solid-select-list>"),de=h("<div class=solid-select-list-placeholder>"),Je=h("<div class=solid-select-option>"),Qe=e=>{const t=J({multiple:!1,disabled:!1,optionToValue:o=>o,isOptionDisabled:o=>!1},e),n=o=>{if(t.multiple&&Array.isArray(o))return o;if(!t.multiple&&!Array.isArray(o))return o!==null?[o]:[];throw new Error(`Incompatible value type for ${t.multiple?"multple":"single"} select.`)},[l,r]=V(t.initialValue!==void 0?n(t.initialValue):[]),s=()=>t.multiple?l():l()[0]||null,d=o=>r(n(o)),v=()=>r([]),S=()=>!!(t.multiple?s().length:s());E(M(l,()=>t.onChange?.(s()),{defer:!0}));const[g,b]=V(""),w=()=>b(""),C=()=>!!g().length;E(M(g,o=>t.onInput?.(o),{defer:!0})),E(M(g,o=>{o&&!a()&&c(!0)},{defer:!0}));const I=typeof t.options=="function"?U(()=>t.options(g()),t.options(g())):()=>t.options,k=()=>I().length,y=o=>{if(t.isOptionDisabled(o))return;const L=t.optionToValue(o);t.multiple?d([...l(),L]):(d(L),_(!1)),c(!1)},[$,_]=V(!1),[a,c]=V(!1),P=()=>c(!a()),[T,j]=V(-1),A=()=>I()[T()],Q=o=>o===A(),W=o=>{k()||j(-1);const L=k()-1,G=o==="next"?1:-1;let z=T()+G;z>L&&(z=0),z<0&&(z=L),j(z)},re=()=>W("previous"),X=()=>W("next");E(M(I,o=>{a()&&j(Math.min(0,o.length-1))},{defer:!0})),E(M(()=>t.disabled,o=>{o&&a()&&c(!1)})),E(M(a,o=>{o?(T()===-1&&X(),_(!0)):(T()>-1&&j(-1),b(""))},{defer:!0})),E(M(T,o=>{o>-1&&!a()&&c(!0)},{defer:!0}));const ne=()=>_(!0),x=()=>{_(!1),c(!1)},F=o=>o.preventDefault(),p=o=>{!t.disabled&&!C()&&P()},N=o=>{b(o.target.value)},q=o=>{switch(o.key){case"ArrowDown":X();break;case"ArrowUp":re();break;case"Enter":if(a()&&A()){y(A());break}return;case"Escape":if(a()){c(!1);break}return;case"Delete":case"Backspace":if(g())return;if(t.multiple){const L=s();d([...L.slice(0,-1)])}else v();break;case" ":if(g())return;a()?A()&&y(A()):c(!0);break;case"Tab":if(A()&&a()){y(A());break}return;default:return}o.preventDefault(),o.stopPropagation()};return{options:I,value:s,setValue:d,hasValue:S,clearValue:v,inputValue:g,setInputValue:b,hasInputValue:C,clearInputValue:w,isOpen:a,setIsOpen:c,toggleOpen:P,isActive:$,setIsActive:_,get multiple(){return t.multiple},get disabled(){return t.disabled},pickOption:y,isOptionFocused:Q,isOptionDisabled:t.isOptionDisabled,onFocusIn:ne,onFocusOut:x,onMouseDown:F,onClick:p,onInput:N,onKeyDown:q}},_e=Pe(),K=()=>{const e=Te(_e);if(!e)throw new Error("No SelectContext found in ancestry.");return e},We=e=>{const[t,n]=fe(J({format:(r,s)=>r,placeholder:"Select...",readonly:typeof e.options!="function",loading:!1,loadingPlaceholder:"Loading...",emptyPlaceholder:"No options"},e),["options","optionToValue","isOptionDisabled","multiple","disabled","onInput","onChange"]),l=Qe(t);return E(M(()=>n.initialValue,r=>r!==void 0&&l.setValue(r))),i(_e.Provider,{value:l,get children(){return i(Xe,{get class(){return n.class},get children(){return[i(Ye,{get id(){return n.id},get name(){return n.name},get format(){return n.format},get placeholder(){return n.placeholder},get autofocus(){return n.autofocus},get readonly(){return n.readonly},ref(r){var s=e.ref;typeof s=="function"?s(r):e.ref=r}}),i(rt,{get loading(){return n.loading},get loadingPlaceholder(){return n.loadingPlaceholder},get emptyPlaceholder(){return n.emptyPlaceholder},get format(){return n.format}})]}})}})},Xe=e=>{const t=K();return(()=>{var n=m(Re);return n.$$mousedown=l=>{t.onMouseDown(l),l.currentTarget.getElementsByTagName("input")[0].focus()},le(n,"focusout",t.onFocusOut,!0),le(n,"focusin",t.onFocusIn,!0),u(n,()=>e.children),R(l=>{var r=`solid-select-container ${e.class!==void 0?e.class:""}`,s=t.disabled;return r!==l.e&&me(n,l.e=r),s!==l.t&&O(n,"data-disabled",l.t=s),l},{e:void 0,t:void 0}),H(),n})()},Ye=e=>{const t=K(),n=l=>{const r=t.value();t.setValue([...r.slice(0,l),...r.slice(l+1)])};return(()=>{var l=m(je),r=l.firstChild,[s,d]=f(r.nextSibling),v=s.nextSibling,[S,g]=f(v.nextSibling),b=S.nextSibling,[w,C]=f(b.nextSibling),I=w.nextSibling,[k,y]=f(I.nextSibling);return le(l,"click",t.onClick,!0),u(l,i(B,{get when(){return U(()=>!t.hasValue())()&&!t.hasInputValue()},get children(){return i(Ze,{get children(){return e.placeholder}})}}),s,d),u(l,i(B,{get when(){return U(()=>!!(t.hasValue()&&!t.multiple))()&&!t.hasInputValue()},get children(){return i(et,{get children(){return e.format(t.value(),"value")}})}}),S,g),u(l,i(B,{get when(){return t.hasValue()&&t.multiple},get children(){return i(ve,{get each(){return t.value()},children:($,_)=>i(tt,{onRemove:()=>n(_()),get children(){return e.format($,"value")}})})}}),w,C),u(l,i(lt,{get id(){return e.id},get name(){return e.name},get autofocus(){return e.autofocus},get readonly(){return e.readonly},ref($){var _=e.ref;typeof _=="function"?_($):e.ref=$}}),k,y),R($=>{var _=t.multiple,a=t.hasValue(),c=t.disabled;return _!==$.e&&O(l,"data-multiple",$.e=_),a!==$.t&&O(l,"data-has-value",$.t=a),c!==$.a&&O(l,"data-disabled",$.a=c),$},{e:void 0,t:void 0,a:void 0}),H(),l})()},Ze=e=>(()=>{var t=m(qe);return u(t,()=>e.children),t})(),et=e=>(()=>{var t=m(Be);return u(t,()=>e.children),t})(),tt=e=>(K(),(()=>{var t=m(He),n=t.firstChild,l=n.nextSibling;return u(n,()=>e.children),l.$$click=r=>{r.stopPropagation(),e.onRemove()},H(),t})()),lt=e=>{const t=K();return(()=>{var n=m(Ke);n.$$mousedown=r=>{r.stopPropagation()},n.$$keydown=r=>{t.onKeyDown(r),r.defaultPrevented||r.key==="Escape"&&(r.preventDefault(),r.stopPropagation(),r.target.blur())},le(n,"input",t.onInput,!0);var l=e.ref;return typeof l=="function"?he(l,n):e.ref=n,R(r=>{var s=e.id,d=e.name,v=t.multiple,S=t.isActive(),g=e.autofocus,b=e.readonly,w=t.disabled;return s!==r.e&&O(n,"id",r.e=s),d!==r.t&&O(n,"name",r.t=d),v!==r.a&&O(n,"data-multiple",r.a=v),S!==r.o&&O(n,"data-is-active",r.o=S),g!==r.i&&ee(n,"autofocus",r.i=g),b!==r.n&&ee(n,"readonly",r.n=b),w!==r.s&&ee(n,"disabled",r.s=w),r},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),R(()=>ee(n,"value",t.inputValue())),H(),n})()},rt=e=>{const t=K();return i(B,{get when(){return t.isOpen()},get children(){var n=m(Ge);return u(n,i(B,{get when(){return!e.loading},get fallback(){return(()=>{var l=m(de);return u(l,()=>e.loadingPlaceholder),l})()},get children(){return i(ve,{get each(){return t.options()},get fallback(){return(()=>{var l=m(de);return u(l,()=>e.emptyPlaceholder),l})()},children:l=>i(nt,{option:l,get children(){return e.format(l,"option")}})})}})),n}})},nt=e=>{const t=K(),n=l=>{E(()=>{t.isOptionFocused(e.option)&&l.scrollIntoView({block:"nearest"})})};return(()=>{var l=m(Je);return l.$$click=()=>t.pickOption(e.option),he(n,l),u(l,()=>e.children),R(r=>{var s=t.isOptionDisabled(e.option),d=t.isOptionFocused(e.option);return s!==r.e&&O(l,"data-disabled",r.e=s),d!==r.t&&O(l,"data-focused",r.t=d),r},{e:void 0,t:void 0}),H(),l})()};$e(["focusin","focusout","mousedown","click","input","keydown"]);var ot=h('<div><!$><!/><div class="w-full relative flex items-center"><!$><!/><!$><!/></div><!$><!/>');function ge(e){const[,t]=fe(e,["ref","onInput","class","value","label","error"]);return(()=>{var n=m(ot),l=n.firstChild,[r,s]=f(l.nextSibling),d=r.nextSibling,v=d.firstChild,[S,g]=f(v.nextSibling),b=S.nextSibling,[w,C]=f(b.nextSibling),I=d.nextSibling,[k,y]=f(I.nextSibling);return u(n,i(Ae,{get name(){return e.name},get label(){return e.label},get required(){return e.required}}),r,s),u(d,i(We,J(t,{get class(){return se("w-full appearance-none space-y-2 rounded-2xl border-2 bg-transparent outline-none md:text-lg lg:space-y-3 lg:text-xl",e.error?"border-red-600/50 dark:border-red-400/50":"border-slate-200 hover:border-slate-300 focus:border-sky-600/50 dark:border-slate-800 dark:hover:border-slate-700 dark:focus:border-sky-400/50",e.placeholder&&!e.value?.length&&"text-slate-500")},get onInput(){return e.onInput},get initialValue(){return e.value},get emptyPlaceholder(){return e.emptyPlaceholder},get id(){return e.name},get name(){return e.name},get"aria-invalid"(){return!!e.error},get"aria-errormessage"(){return`${e.name}-error`}})),S,g),u(d,i(B,{get when(){return!e.multiple},get children(){return i(D,{icon:"pepicons-pencil:angle-down",class:"pointer-events-none absolute right-6 h-5 lg:right-8 lg:h-6"})}}),w,C),u(n,i(De,{get name(){return e.name},get error(){return e.error}}),k,y),R(()=>me(n,se("px-8 lg:px-10",e.class))),n})()}var it=h('<div class="flex justify-center semi-bold text-green-500">'),at=h('<div class="mt-4 flex justify-between"><!$><!/><!$><!/>'),st=h('<dialog class=modal><div class="flex w-full max-w-2xl flex-col justify-center self-center rounded-md bg-current px-10 py-6"><!$><!/><!$><!/><!$><!/>'),ut=h('<div><div class="container prose mx-auto mb-8 w-full max-w-4xl"><h1>Share todo list</h1></div><div class="prose mb-8 w-full px-8"><div class="w-full tooltip"data-tip="Edit permissions"><button class="flex w-full justify-between rounded-lg p-2 text-lg font-semibold hover:bg-gray-600">Shared with<div><!$><!/><!$><!/></div></button></div><ul>'),ct=h("<li><!$><!/> - <!$><!/>");function dt(e){const[t,n]=be,[l,r]=V([]),[s,{Form:d,Field:v}]=Me(),[S,g]=V(),[b,w]=V([]),[C,I]=V([]),[k,y]=V(!1);Fe(()=>{oe.fetchTodoListRoles().then(a=>{I(a)}),oe.fetchTodoListMembers(e.todoList.id).then(a=>{a.push({user:e.todoList.author,role:{id:0,name:"owner"},active:!1}),r(a)})});const $=a=>{console.log("submitting share todo list form with values:",a),oe.shareTodoList(e.todoList.id,{user_ids:a.users.map(c=>c.id),role_id:a.role.id}).then(()=>{console.log("todo list shared"),g(void 0);const c=[...l(),...a.users.map(P=>({user:P,role:a.role,active:!1}))];r(c),y(!0),setTimeout(()=>{y(!1)},7e3),e.onSuccess(c)}).catch(c=>{console.log("error:",c),g(c.message),y(!1)})},_=async a=>{a&&Ue.findUsers(a).then(c=>{console.log("found users:",c),w(c.filter(P=>l().find(T=>T.user.username===P.username)===void 0).filter(P=>P.username!==t.username))})};return(()=>{var a=m(st),c=a.firstChild,P=c.firstChild,[T,j]=f(P.nextSibling),A=T.nextSibling,[Q,W]=f(A.nextSibling),re=Q.nextSibling,[X,ne]=f(re.nextSibling);return u(c,(()=>{var x=U(()=>l().length>0);return()=>x()&&(()=>{var F=m(ut),p=F.firstChild,N=p.nextSibling,q=N.firstChild,o=q.firstChild,L=o.firstChild,G=L.nextSibling,z=G.firstChild,[ie,xe]=f(z.nextSibling),pe=ie.nextSibling,[Se,ye]=f(pe.nextSibling),we=q.nextSibling;return o.$$click=()=>console.log("edit permissions"),u(G,i(D,{class:"ml-3 align-bottom text-2xl",icon:"fluent:person-20-regular"}),ie,xe),u(G,i(D,{class:"-ml-1 mr-1 align-bottom",icon:"fluent:edit-12-regular"}),Se,ye),u(we,()=>l().filter(Y=>Y.user.id!==t.userId).map(Y=>(()=>{var Z=m(ct),Ie=Z.firstChild,[ae,ke]=f(Ie.nextSibling),Ce=ae.nextSibling,Le=Ce.nextSibling,[Ve,Oe]=f(Le.nextSibling);return u(Z,()=>Y.user.username,ae,ke),u(Z,()=>Y.role.name,Ve,Oe),Z})())),H(),F})()})(),T,j),u(c,i(Ne,{get error(){return S()},formName:"shareTodoList"}),Q,W),u(c,i(d,{onSubmit:$,get children(){return[i(v,{name:"users",get validate(){return[ze("Please select at least one user.")]},children:(x,F)=>i(ge,J(F,{label:"Add users",onInput:_,onChange:p=>{console.log(p),s.internal.fields.users?.value.set(p)},format:(p,N)=>p.username,get options(){return b()},multiple:!0,required:!0,placeholder:"Type to search for users",get error(){return x.error}}))}),i(v,{name:"role",children:(x,F)=>i(ge,J(F,{label:"Role",onInput:void 0,onChange:p=>{s.internal.fields.role?.value.set(p)},format:(p,N)=>p.name,get value(){return C()[1]},get options(){return C()},get error(){return x.error}}))}),(()=>{var x=m(it);return u(x,()=>k()&&"Todo list shared successfully"),x})(),(()=>{var x=m(at),F=x.firstChild,[p,N]=f(F.nextSibling),q=p.nextSibling,[o,L]=f(q.nextSibling);return u(x,i(ue,{type:"button",get loading(){return s.submitting},label:"Close",variant:"secondary",onClick:()=>e.onClose?.()}),p,N),u(x,i(ue,{get loading(){return s.submitting},label:"share",variant:"primary"}),o,L),x})()]}}),X,ne),R(()=>O(a,"id",e.dialogId)),a})()}$e(["click"]);var gt=h('<svg xmlns=http://www.w3.org/2000/svg width=28 height=28 viewBox="0 0 48 48"><path fill=#3f51b5 d="m17.8 18.1l-7.4 7.3l-4.2-4.1L4 23.5l6.4 6.4l9.6-9.6zm0-13l-7.4 7.3l-4.2-4.1L4 10.5l6.4 6.4L20 7.3zm0 26l-7.4 7.3l-4.2-4.1L4 36.5l6.4 6.4l9.6-9.6z"></path><path fill=#90caf9 d="M24 22h20v4H24zm0-13h20v4H24zm0 26h20v4H24z">');m(gt);var ft=h("<div><!$><!/><!$><!/>");const St=()=>{const[e,t]=be,[n,l]=Ee,[r,s]=V(null);E(()=>{console.log("active.todoList",n.todoList),n.todoList?s(n.todoList):s(null)});const d="share-modal";return(()=>{var v=m(ft),S=v.firstChild,[g,b]=f(S.nextSibling),w=g.nextSibling,[C,I]=f(w.nextSibling);return u(v,(()=>{var k=U(()=>!!e.username);return()=>k()?i(te,{get label(){return[i(D,{class:"mr-1 align-bottom text-2xl",icon:"fluent:home-20-filled"}),"My todo lists"]},href:"/todo-lists"}):i(te,{get label(){return[i(D,{class:"mr-1 align-bottom text-2xl",icon:"fluent:person-accounts-20-filled"}),"Login or sign up to get started"]}})})(),g,b),u(v,(()=>{var k=U(()=>!!r());return()=>k()&&[i(te,{get label(){return[i(D,{class:"align-bottom text-2xl",icon:"fluent:task-list-20-regular"}),i(D,{class:"-ml-1 mr-1 align-bottom",icon:"fluent:edit-20-regular"}),U(()=>r()?.name??"Could not fetch todo list info")]}}),i(te,{get label(){return[i(D,{class:"align-bottom text-2xl",icon:"fluent:share-20-regular"}),i(D,{class:"-ml-1 mr-1 align-bottom",icon:"fluent:person-12-regular"}),"Share"]},onClick:()=>ce.open(d)}),i(dt,{get todoList(){return r()},dialogId:d,onClose:()=>ce.close(d),onSuccess:y=>{l("todoList",{...r(),members:y})}})]})(),C,I),v})()};export{St as default};
