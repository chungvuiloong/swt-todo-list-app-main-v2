import{c as N,g as v,t as y,b as a,i,d as l,m as U,h as j,j as te,s as oe,f as le,r as ie,a as J,k as ne,o as re,F as K}from"./store.BVrLplq6.js";import{u as z}from"./userState.D8IPT1p-.js";import{b as G,t as k,a as se}from"./todoActions.CcFcA-pD.js";import{I as E}from"./IconButton.ZQ257svR.js";import{T as B}from"./TextInput.DV86XHqt.js";import{c as Y,F as ae,r as Z,A as O}from"./FormError.BjAbR7KG.js";import{I as de}from"./iconify.ByqseDuz.js";import{d as Q}from"./dialogUtil.C29_IkiY.js";var ce=y('<div class="mt-4 flex justify-between"><!$><!/><!$><!/>'),ue=y('<div class="flex self-center max-w-md w-full flex-col justify-center"><div class="container prose mb-8"><h1>Create a new todo list</h1></div><!$><!/><!$><!/>');function ge(e){const[g,{Form:p,Field:m}]=Y(),[_,h]=G,[f,$]=N(),T=d=>{console.log("submitting create todo list form with values:",d),k.createTodoList(d).then(c=>{console.log("todo list created:",c),h(_.length,c),Object.values(g.internal.fields).forEach(u=>{u.value.set("")}),$(void 0),e.onSuccess()}).catch(c=>{console.log("error:",c),$(c.message)})};return(()=>{var d=v(ue),c=d.firstChild,u=c.nextSibling,[s,w]=a(u.nextSibling),S=s.nextSibling,[L,o]=a(S.nextSibling);return i(d,l(ae,{get error(){return f()},formName:"login"}),s,w),i(d,l(p,{onSubmit:T,get children(){return[l(m,{name:"name",get validate(){return[Z("The todo list needs to have a name.")]},children:(t,n)=>l(B,U(n,{label:"Name",type:"text",get value(){return t.value},get error(){return t.error},required:!0}))}),l(m,{name:"description",children:(t,n)=>l(B,U(n,{label:"Description",type:"textarea",get value(){return t.value},get error(){return t.error},required:!0}))}),(()=>{var t=v(ce),n=t.firstChild,[r,C]=a(n.nextSibling),I=r.nextSibling,[F,x]=a(I.nextSibling);return i(t,l(O,{type:"button",get loading(){return g.submitting},label:"Close",variant:"secondary",onClick:()=>e.onClose()}),r,C),i(t,l(O,{get loading(){return g.submitting},label:"Create",variant:"primary"}),F,x),t})()]}}),L,o),d})()}var me=y('<div class=flex><div class=flex-grow><!$><!/><!$><!/></div><div class="mt-1 flex h-fit flex-shrink flex-row"><!$><!/><!$><!/><!$><!/><!$><!/>');function fe(e){const{todoList:g,todoListIndex:p}=e,[m,{Form:_,Field:h}]=Y({initialValues:{name:g.name,description:g.description}}),[f,$]=G,[T,d]=N();return l(_,{onSubmit:u=>{console.log("submitting edit todo item form with values:",u),k.updateTodoList(g.id,u).then(s=>{console.log("todo item edited:",s),$(p,s),e.onSuccess(s),m.internal.fields.description?.value.set(""),d(void 0)}).catch(s=>{console.log("setting error:",s),d(s.message)})},class:"flex flex-grow flex-col justify-center self-center",get children(){var u=v(me),s=u.firstChild,w=s.firstChild,[S,L]=a(w.nextSibling),o=S.nextSibling,[t,n]=a(o.nextSibling),r=s.nextSibling,C=r.firstChild,[I,F]=a(C.nextSibling),x=I.nextSibling,[b,D]=a(x.nextSibling),q=b.nextSibling,[M,H]=a(q.nextSibling),P=M.nextSibling,[R,ee]=a(P.nextSibling);return i(s,l(h,{name:"name",get validate(){return[Z("Name is required.")]},children:(A,V)=>l(B,U(V,{label:"Name",type:"text",get value(){return A.value},get error(){return A.error},required:!0}))}),S,L),i(s,l(h,{name:"description",children:(A,V)=>l(B,U(V,{label:"Description",type:"textarea",get value(){return A.value},get error(){return A.error},required:!0}))}),t,n),i(r,l(E,{get loading(){return m.submitting},icon:"fluent:save-20-regular",iconClass:"text-blue-400",type:"submit"}),I,F),i(r,l(E,{get loading(){return m.submitting},icon:"fluent:edit-off-20-regular",iconClass:"text-yellow-600",onClick:()=>e.onClose?.()}),b,D),i(r,l(E,{icon:"fluent:copy-20-regular",iconClass:"text-gray-600",disabled:!0}),M,H),i(r,l(E,{icon:"fluent:delete-20-regular",iconClass:"text-gray-600",disabled:!0}),R,ee),u}})}var $e=y('<dialog class=modal><div class="max-w-2xl flex flex-col py-4 px-8 space-y-4 bg-slate-400 rounded-lg shadow-lg"><h1 class="text-3xl font-bold text-gray-800">Deleting todo list "<!$><!/>"</h1><p class="ml-4 mt-2 text-xl font-semibold text-gray-700"><!$><!/><!$><!/><br>Are you sure you want to delete this todo list?</p><div class="mt-4 flex flex-row justify-between space-x-4"><!$><!/><!$><!/>'),W=y("<br>");const xe=e=>{const[g,p]=z;return(()=>{var m=v($e),_=m.firstChild,h=_.firstChild,f=h.firstChild,$=f.nextSibling,[T,d]=a($.nextSibling);T.nextSibling;var c=h.nextSibling,u=c.firstChild,[s,w]=a(u.nextSibling),S=s.nextSibling,[L,o]=a(S.nextSibling);L.nextSibling;var t=c.nextSibling,n=t.firstChild,[r,C]=a(n.nextSibling),I=r.nextSibling,[F,x]=a(I.nextSibling);return i(h,()=>e.todoList.name,T,d),i(c,(()=>{var b=j(()=>!!e.todoList.todos?.length);return()=>b()?["This todo list is not empty.",v(W)]:null})(),s,w),i(c,(()=>{var b=j(()=>!!(e.todoList.author.id!==g.userId||e.todoList.members?.length));return()=>b()?["This todo list is shared with other users.",v(W)]:null})(),L,o),i(t,l(O,{label:"Cancel",variant:"primary",onClick:()=>e.onClose()}),r,C),i(t,l(O,{label:"Delete",variant:"danger",onClick:()=>{e.onDelete(e.todoList.id),e.onClose()}}),F,x),te(()=>oe(m,"id",e.modalId)),m})()};var be=y('<div class="flex max-w-full items-center justify-between border-t-2 border-gray-200 pb-4 pt-4">'),_e=y('<div class="flex flex-grow"><a href=/todos class="flex w-full flex-grow cursor-pointer flex-row rounded-lg p-2 transition-colors hover:bg-gray-700 "><span class="h-fit w-2/5 scroll-ms-4 overflow-x-auto whitespace-pre-wrap text-2xl font-medium"></span><span class="w-3/5 overflow-x-auto whitespace-pre-wrap text-xl"></span><span class="h-fit w-2/5 overflow-x-auto whitespace-pre-wrap text-xl"></span><!$><!/></a><div class="mt-1 flex h-fit flex-shrink"><!$><!/><!$><!/><!$><!/></div><!$><!/>');const X=e=>{const[g,p]=z,[m,_]=N(!1);N(!1);const h=e.todoList.todos?.length??!1?`${e.todoList.todos?.reduce(($,T)=>T.completed?$+1:$,0)}/${e.todoList.todos?.length} completed`:"no todos",f=`todo-list-delete-confirmation-${e.todoList.id}`;return(()=>{var $=v(be);return i($,(()=>{var T=j(()=>!!m());return()=>T()?l(fe,{get todoListIndex(){return e.index},get todoList(){return e.todoList},onSuccess:d=>{e.update(e.todoList.id,d),_(!1)},onClose:()=>_(!1)}):(()=>{var d=v(_e),c=d.firstChild,u=c.firstChild,s=u.nextSibling,w=s.nextSibling,S=w.nextSibling,[L,o]=a(S.nextSibling),t=c.nextSibling,n=t.firstChild,[r,C]=a(n.nextSibling),I=r.nextSibling,[F,x]=a(I.nextSibling),b=F.nextSibling,[D,q]=a(b.nextSibling),M=t.nextSibling,[H,P]=a(M.nextSibling);return c.$$click=()=>e.handleSelectTodoList(e.todoList),i(u,()=>e.todoList.name),i(s,()=>e.todoList.description),i(w,h),i(c,l(de,{class:"h-fit text-4xl",icon:"fluent:arrow-enter-20-regular"}),L,o),i(t,l(E,{icon:"fluent:edit-20-regular",iconClass:"text-yellow-600",get disabled(){return e.todoList.role!=="owner"},onClick:()=>_(!0)}),r,C),i(t,l(E,{icon:"fluent:copy-20-regular",iconClass:"text-sky-700",onClick:()=>e.clone(e.todoList.id,e.todoList.name+" (cloned)")}),F,x),i(t,l(E,{icon:"fluent:delete-20-regular",iconClass:"text-orange-700",get disabled(){return e.todoList.role!=="owner"},onClick:()=>{e.todoList.author.id!==g.userId||(e.todoList.members?.length??0)>0||(e.todoList.todos?.length??0)>0?Q.open(f):e.delete(e.todoList.id)}}),D,q),i(d,l(xe,{modalId:f,get todoList(){return e.todoList},onClose:()=>Q.close(f),onDelete:R=>{e.delete(R)}}),H,P),ie(),d})()})()),$})()};le(["click"]);var he=y('<div class="flex w-full max-w-4xl grow flex-col"><div class="container prose mb-8 w-full max-w-full pb-2"><h1>My todo lists</h1></div><div class="flex w-full max-w-full flex-col"></div><div class="over container mt-16 w-full max-w-full border-b-2 border-gray-200"></div><!$><!/>'),ve=y('<div class="flex max-w-full flex-col items-center justify-between border-t-2 border-gray-200 pb-6 pt-6"><p class=text-xl>Create your first todo list with the button above'),we=y('<div class="container prose mb-8 mt-16 w-full max-w-full pb-2"><h1>Shared with me'),Se=y('<div class="over container w-full max-w-full border-b-2 border-gray-200">');function Ee(){const[e,g]=G,[p,m]=N([]),[_,h]=N([]),[f,$]=z,[T,d]=se,[c,u]=N(!1),s=async o=>{const t=e.find(n=>n.id===o);if(t)for(const n of t.todos??[])await k.deleteTodoItem(t.id,n.id);k.deleteTodoList(o).then(()=>{g(e.filter(n=>n.id!==o))})},w=(o,t)=>{const n=e.findIndex(r=>r.id===o);console.log("updating todo list:",t),g(n,t)},S=(o,t)=>{const n=e.find(r=>r.id===o);n&&k.cloneTodoList(n.id,t).then(async r=>{const C=await k.fetchTodoItems(r.id);r.todos=C,g(e.length,r)})},L=o=>{d("todoList",o)};return J(re(()=>f,o=>o&&!o.username&&location.assign("/login"))),ne(async()=>{const o=await k.fetchTodoLists();for(const t of o){const n=await k.fetchTodoItems(t.id);t.todos=n;const r=await k.fetchTodoListMembers(t.id);t.members=r}g(o)}),J(()=>{m(e.filter(o=>o.author.id===f.userId)),h(e.filter(o=>o.author.id!==f.userId))}),f.username&&(()=>{var o=v(he),t=o.firstChild,n=t.nextSibling,r=n.nextSibling,C=r.nextSibling,[I,F]=a(C.nextSibling);return i(n,(()=>{var x=j(()=>!!c());return()=>x()?l(ge,{onClose:()=>u(!1),onSuccess:()=>u(!1)}):l(E,{icon:"fluent:form-new-20-regular",iconClass:"mr-2 text-yellow-500",label:"New todo list",onClick:()=>u(!0)})})()),i(r,(()=>{var x=j(()=>p().length===0);return()=>x()?v(ve):l(K,{get each(){return p()},children:(b,D)=>l(X,{todoList:b,get index(){return D()},handleSelectTodoList:L,clone:S,update:w,delete:s})})})()),i(o,(()=>{var x=j(()=>_().length>0);return()=>x()&&[v(we),(()=>{var b=v(Se);return i(b,l(K,{get each(){return _()},children:(D,q)=>l(X,{todoList:D,get index(){return q()},handleSelectTodoList:L,clone:S,update:w,delete:s})})),b})()]})(),I,F),o})()}export{Ee as default};
