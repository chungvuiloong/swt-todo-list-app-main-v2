import{c as oe,m as p,z as f,A as b,a as K,l as ue,e as N,p as ce,g as x,t as F,u as de,n as Q,r as X,i as w,f as D,s as j,d as _,b as H,q as fe,S as z}from"./store.CkftJ29u.js";import{u as ge}from"./userState.CTXuh5W2.js";function d(e){const[t,r]=oe(e);return{get:t,set:r}}function ye({initialValues:e={},validateOn:t="submit",revalidateOn:r="input",validate:n}={}){const i=d([]),o=d([]),l=d(),a=d(0),u=d(!1),s=d(!1),g=d(!1),c=d(!1),y=d(!1),v=d(!1),m=d({});return{internal:{initialValues:e,validate:n,validateOn:t,revalidateOn:r,fieldNames:i,fieldArrayNames:o,element:l,submitCount:a,submitting:u,submitted:s,validating:g,touched:c,dirty:y,invalid:v,response:m,fields:{},fieldArrays:{},validators:new Set},get element(){return l.get()},get submitCount(){return a.get()},get submitting(){return u.get()},get submitted(){return s.get()},get validating(){return g.get()},get touched(){return c.get()},get dirty(){return y.get()},get invalid(){return v.get()},get response(){return m.get()}}}function He(e){const t=ye(e);return[t,{Form:r=>Ie(p({of:t},r)),Field:r=>we(p({of:t},r)),FieldArray:r=>Te(p({of:t},r))}]}function G(e,t,r){const{checked:n,files:i,options:o,value:l,valueAsDate:a,valueAsNumber:u}=e;return f(()=>!r||r==="string"?l:r==="string[]"?o?[...o].filter(s=>s.selected&&!s.disabled).map(s=>s.value):n?[...t.value.get()||[],l]:(t.value.get()||[]).filter(s=>s!==l):r==="number"?u:r==="boolean"?n:r==="File"&&i?i[0]:r==="File[]"&&i?[...i]:r==="Date"&&a?a:t.value.get())}function R(e){return[...Object.values(e.internal.fields),...Object.values(e.internal.fieldArrays)]}function k(e,t){return e.internal.fieldArrays[t]}function he(e,t){return+t.replace(`${e}.`,"").split(".")[0]}function Y(e,t){Z(e,!1).forEach(r=>{const n=f(k(e,r).items.get).length-1;t.filter(i=>i.startsWith(`${r}.`)&&he(r,i)>n).forEach(i=>{t.splice(t.indexOf(i),1)})})}function Z(e,t=!0){const r=[...f(e.internal.fieldArrayNames.get)];return t&&Y(e,r),r}function ve(e,t=!0){const r=[...f(e.internal.fieldNames.get)];return t&&Y(e,r),r}function $(e,t){return e.internal.fields[t]}function B(e,t,r){return f(()=>{const n=ve(e,r),i=Z(e,r);return typeof t=="string"||Array.isArray(t)?(typeof t=="string"?[t]:t).reduce((o,l)=>{const[a,u]=o;return i.includes(l)?(i.forEach(s=>{s.startsWith(l)&&u.add(s)}),n.forEach(s=>{s.startsWith(l)&&a.add(s)})):a.add(l),o},[new Set,new Set]).map(o=>[...o]):[n,i]})}function q(e,t){return(typeof e!="string"&&!Array.isArray(e)?e:t)||{}}function I(e,t){return e.split(".").reduce((r,n)=>r?.[n],t)}let me=0;function C(){return me++}function be(e,t){const r=n=>n instanceof Blob?n.size:n;return Array.isArray(e)&&Array.isArray(t)?e.map(r).join()!==t.map(r).join():e instanceof Date&&t instanceof Date?e.getTime()!==t.getTime():Number.isNaN(e)&&Number.isNaN(t)?!1:e!==t}function Ae(e,t){f(()=>e.internal.dirty.set(t||R(e).some(r=>r.active.get()&&r.dirty.get())))}function ke(e,t){f(()=>{const r=be(t.startValue.get(),t.value.get());r!==t.dirty.get()&&b(()=>{t.dirty.set(r),Ae(e,r)})})}function $e(e,t,r,{on:n,shouldFocus:i=!1}){f(()=>{n.includes((e.internal.validateOn==="submit"?e.internal.submitted.get():t.error.get())?e.internal.revalidateOn:e.internal.validateOn)&&ne(e,r,{shouldFocus:i})})}function P(e,t,r,n,i,o){b(()=>{t.value.set(l=>t.transform.reduce((a,u)=>u(a,n),o??l)),t.touched.set(!0),e.internal.touched.set(!0),ke(e,t),$e(e,t,r,{on:i})})}function pe(e,t){if(!k(e,t)){const r=I(t,e.internal.initialValues)?.map(()=>C())||[],n=d(r),i=d(r),o=d(r),l=d(""),a=d(!1),u=d(!1),s=d(!1);e.internal.fieldArrays[t]={initialItems:n,startItems:i,items:o,error:l,active:a,touched:u,dirty:s,validate:[],consumers:new Set},e.internal.fieldArrayNames.set(g=>[...g,t])}return k(e,t)}function xe(e,t){if(!$(e,t)){const r=I(t,e.internal.initialValues),n=d([]),i=d(r),o=d(r),l=d(r),a=d(""),u=d(!1),s=d(!1),g=d(!1);e.internal.fields[t]={elements:n,initialValue:i,startValue:o,value:l,error:a,active:u,touched:s,dirty:g,validate:[],transform:[],consumers:new Set},e.internal.fieldNames.set(c=>[...c,t])}return $(e,t)}function Fe(e,t,{shouldActive:r=!0}){const n=Object.entries(t).reduce((i,[o,l])=>([$(e,o),k(e,o)].every(a=>!a||r&&!f(a.active.get))&&i.push(l),i),[]).join(" ");n&&e.internal.response.set({status:"error",message:n})}function ee(e,t){f(()=>{e.internal.invalid.set(t||R(e).some(r=>r.active.get()&&r.error.get()))})}function V(e){let t=!1,r=!1,n=!1;f(()=>{for(const i of R(e))if(i.active.get()&&(i.touched.get()&&(t=!0),i.dirty.get()&&(r=!0),i.error.get()&&(n=!0)),t&&r&&n)break}),b(()=>{e.internal.touched.set(t),e.internal.dirty.set(r),e.internal.invalid.set(n)})}function te(e,t){f(()=>$(e,t)?.elements.get()[0]?.focus())}function Se(e,t,r,{shouldActive:n=!0,shouldTouched:i=!1,shouldDirty:o=!1,shouldFocus:l=!!r}={}){b(()=>{f(()=>{for(const a of[$(e,t),k(e,t)])a&&(!n||a.active.get())&&(!i||a.touched.get())&&(!o||a.dirty.get())&&(a.error.set(r),r&&"value"in a&&l&&te(e,t))}),ee(e,!!r)})}function re(e,t,r){const[n,i]=B(e,t),{shouldActive:o=!0,shouldTouched:l=!1,shouldDirty:a=!1,shouldValid:u=!1}=q(t,r);return typeof t!="string"&&!Array.isArray(t)?e.internal.fieldNames.get():i.forEach(s=>k(e,s).items.get()),n.reduce((s,g)=>{const c=$(e,g);return(!o||c.active.get())&&(!l||c.touched.get())&&(!a||c.dirty.get())&&(!u||!c.error.get())&&(typeof t=="string"?g.replace(`${t}.`,""):g).split(".").reduce((y,v,m,A)=>y[v]=m===A.length-1?c.value.get():typeof y[v]=="object"&&y[v]||(isNaN(+A[m+1])?{}:[]),s),s},typeof t=="string"?[]:{})}function Ee(e,t,r){const[n,i]=B(e,t,!1),o=typeof t=="string"&&n.length===1,l=!o&&!Array.isArray(t),a=q(t,r),{initialValue:u,initialValues:s,keepResponse:g=!1,keepSubmitCount:c=!1,keepSubmitted:y=!1,keepValues:v=!1,keepDirtyValues:m=!1,keepItems:A=!1,keepDirtyItems:le=!1,keepErrors:L=!1,keepTouched:J=!1,keepDirty:W=!1}=a;b(()=>f(()=>{n.forEach(S=>{const h=$(e,S);(o?"initialValue"in a:s)&&h.initialValue.set(()=>o?u:I(S,s));const E=m&&h.dirty.get();!v&&!E&&(h.startValue.set(h.initialValue.get),h.value.set(h.initialValue.get),h.elements.get().forEach(U=>{U.type==="file"&&(U.value="")})),J||h.touched.set(!1),!W&&!v&&!E&&h.dirty.set(!1),L||h.error.set("")}),i.forEach(S=>{const h=k(e,S),E=le&&h.dirty.get();!A&&!E&&(s&&h.initialItems.set(I(S,s)?.map(()=>C())||[]),h.startItems.set([...h.initialItems.get()]),h.items.set([...h.initialItems.get()])),J||h.touched.set(!1),!W&&!A&&!E&&h.dirty.set(!1),L||h.error.set("")}),l&&(g||e.internal.response.set({}),c||e.internal.submitCount.set(0),y||e.internal.submitted.set(!1)),V(e)}))}function Ne(e,t,{duration:r}={}){e.internal.response.set(t),r&&setTimeout(()=>{f(e.internal.response.get)===t&&e.internal.response.set({})},r)}async function ne(e,t,r){const[n,i]=B(e,t),{shouldActive:o=!0,shouldFocus:l=!0}=q(t,r),a=C();e.internal.validators.add(a),e.internal.validating.set(!0);const u=e.internal.validate?await e.internal.validate(f(()=>re(e,{shouldActive:o}))):{};let s=typeof t!="string"&&!Array.isArray(t)?!Object.keys(u).length:!0;const[g]=await Promise.all([Promise.all(n.map(async c=>{const y=$(e,c);if(!o||f(y.active.get)){let v;for(const A of y.validate)if(v=await A(f(y.value.get)),v)break;const m=v||u[c]||"";return m&&(s=!1),y.error.set(m),m?c:null}})),Promise.all(i.map(async c=>{const y=k(e,c);if(!o||f(y.active.get)){let v="";for(const A of y.validate)if(v=await A(f(y.items.get)),v)break;const m=v||u[c]||"";m&&(s=!1),y.error.set(m)}}))]);return b(()=>{if(Fe(e,u,{shouldActive:o}),l){const c=g.find(y=>y);c&&te(e,c)}ee(e,!s),e.internal.validators.delete(a),e.internal.validators.size||e.internal.validating.set(!1)}),s}function ie({of:e,name:t,getStore:r,validate:n,transform:i,keepActive:o=!1,keepState:l=!0}){K(()=>{const a=r();a.validate=n?Array.isArray(n)?n:[n]:[],"transform"in a&&(a.transform=i?Array.isArray(i)?i:[i]:[]);const u=C();a.consumers.add(u),f(a.active.get)||b(()=>{a.active.set(!0),V(e)}),ue(()=>setTimeout(()=>{a.consumers.delete(u),b(()=>{!o&&!a.consumers.size&&(a.active.set(!1),l?V(e):Ee(e,t))}),"elements"in a&&a.elements.set(s=>s.filter(g=>g.isConnected))}))})}function we(e){const t=N(()=>xe(e.of,e.name));return ie(p({getStore:t},e)),N(()=>e.children({get name(){return e.name},get value(){return t().value.get()},get error(){return t().error.get()},get active(){return t().active.get()},get touched(){return t().touched.get()},get dirty(){return t().dirty.get()}},{get name(){return e.name},get autofocus(){return!!t().error.get()},ref(r){t().elements.set(n=>[...n,r]),K(()=>{if(r.type!=="radio"&&t().startValue.get()===void 0&&f(t().value.get)===void 0){const n=G(r,t(),e.type);t().startValue.set(()=>n),t().value.set(()=>n)}})},onInput(r){P(e.of,t(),e.name,r,["touched","input"],G(r.currentTarget,t(),e.type))},onChange(r){P(e.of,t(),e.name,r,["change"])},onBlur(r){P(e.of,t(),e.name,r,["touched","blur"])}}))}function Te(e){const t=N(()=>pe(e.of,e.name));return ie(p({getStore:t},e)),N(()=>e.children({get name(){return e.name},get items(){return t().items.get()},get error(){return t().error.get()},get active(){return t().active.get()},get touched(){return t().touched.get()},get dirty(){return t().dirty.get()}}))}let M=class extends Error{name="FormError";errors;constructor(t,r){super(typeof t=="string"?t:""),this.errors=typeof t=="string"?r||{}:t}};var _e=F("<form novalidate>");function Ie(e){const[,t,r]=ce(e,["of"],["keepResponse","shouldActive","shouldTouched","shouldDirty","shouldFocus"]);return(()=>{var n=x(_e),i=e.of.internal.element.set;return typeof i=="function"?de(i,n):e.of.internal.element.set=n,Q(n,p(r,{onSubmit:async o=>{o.preventDefault();const{of:l,onSubmit:a,responseDuration:u}=e;b(()=>{t.keepResponse||l.internal.response.set({}),l.internal.submitCount.set(s=>s+1),l.internal.submitted.set(!0),l.internal.submitting.set(!0)});try{await ne(l,t)&&await a(re(l,t),o)}catch(s){b(()=>{s instanceof M&&Object.entries(s.errors).forEach(([g,c])=>{c&&Se(l,g,c,{...t,shouldFocus:!1})}),(!(s instanceof M)||s.message)&&Ne(l,{status:"error",message:s?.message||"An unknown error has occurred."},{duration:u})})}finally{l.internal.submitting.set(!1)}}}),!1,!1),X(),n})()}function Me(e){return t=>!t&&t!==0||Array.isArray(t)&&!t.length?e:""}function se(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var i=e.length;for(t=0;t<i;t++)e[t]&&(r=se(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function ae(){for(var e,t,r=0,n="",i=arguments.length;r<i;r++)(e=arguments[r])&&(t=se(e))&&(n&&(n+=" "),n+=t);return n}var De=F('<div class="pt-4 text-sm text-red-500 md:text-base lg:pt-5 lg:text-lg dark:text-red-400">');function Ke(e){return(()=>{var t=x(De);return w(t,()=>e.error),D(()=>j(t,"id",`${e.name}-error`)),t})()}var je=F("<label><!$><!/> <!$><!/>"),Ce=F('<span class="ml-1 text-red-600 dark:text-red-400">*');function Qe(e){return _(z,{get when(){return e.label},get children(){var t=x(je),r=t.firstChild,[n,i]=H(r.nextSibling),o=n.nextSibling,l=o.nextSibling,[a,u]=H(l.nextSibling);return w(t,()=>e.label,n,i),w(t,(()=>{var s=N(()=>!!e.required);return()=>s()&&x(Ce)})(),a,u),D(s=>{var g=ae("prose inline-block font-medium md:text-lg lg:text-xl",!e.margin&&"mb-4 lg:mb-5"),c=e.name;return g!==s.e&&fe(t,s.e=g),c!==s.t&&j(t,"for",s.t=c),s},{e:void 0,t:void 0}),t}})}var Oe=F('<div class="h-5 w-5 animate-spin rounded-full border-t-2 border-r-2 border-t-current border-r-transparent md:h-[22px] md:w-[22px] md:border-t-[2.5px] md:border-r-[2.5px] lg:h-6 lg:w-6">');function Pe(e){return(()=>{var t=x(Oe);return D(()=>j(t,"aria-label",e.label||"Loading")),t})()}var Ve=F("<button>");function Xe(e){return(()=>{var t=x(Ve);return Q(t,p({get class(){return ae("items-center rounded-lg px-3 py-1.5 font-medium md:text-md lg:rounded-lg lg:px-4 lg:py-2 lg:text-lg",e.variant==="primary"&&"bg-sky-600 text-white hover:bg-sky-600/80 dark:bg-sky-400 dark:text-gray-900 dark:hover:bg-sky-400/80",e.variant==="secondary"&&"bg-sky-600/10 text-sky-600 hover:bg-sky-600/20 dark:bg-sky-400/10 dark:text-sky-400 dark:hover:bg-sky-400/20",e.variant==="danger"&&"bg-red-600 text-white hover:bg-red-600/80 dark:bg-red-400 dark:text-gray-900 dark:hover:bg-red-400/80")}},e),!1,!0),w(t,_(z,{get when(){return e.loading},get fallback(){return e.label},get children(){return _(Pe,{get label(){return`${e.label} is loading`}})}})),X(),t})()}const T="http://localhost:4322",ze=async(e,t)=>{const{accessToken:r,refreshToken:n}=e,i=await fetch(`${T}/api/users/refresh-token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:r,refreshToken:n})}).then(async o=>{if(!o.ok)throw t({username:null,accessToken:null,refreshToken:null}),location.assign("/login"),new Error("Failed to refresh token");return o.json()});return t(i),i},O=async(e,t,r=7e3)=>{const[n,i]=ge,o={...t.headers,Authorization:n.accessToken?`Bearer ${n.accessToken}`:""};return console.log("fetching:",`${T}${e}`),fetch(`${T}${e}`,{...t,headers:o,signal:AbortSignal.timeout(r)}).then(async l=>{let a=await l.json();if(l.status===401&&a.detail==="Token has expired"){const u=await ze(n,i),s={...o,Authorization:`Bearer ${u.accessToken}`};l=await fetch(`${T}${e}`,{...t,headers:s,signal:AbortSignal.timeout(r)}),a=await l.json()}if(!l.ok)throw new Error(a.detail);return a})},Re=async(e,t={})=>O(e,{...t,method:"GET"}),Be=async(e,t={},r={})=>{const n={...r.headers,"Content-Type":"application/json"};return O(e,{...r,headers:n,method:"POST",body:JSON.stringify(t)})},qe=async(e,t,r={})=>{const n={...r.headers,"Content-Type":"application/json"};return O(e,{...r,headers:n,method:"PUT",body:JSON.stringify(t)})},Le=async(e,t={})=>O(e,{...t,method:"DELETE"}),Ye={get:Re,post:Be,put:qe,del:Le};var Je=F('<div class="py-4 text-sm text-red-500 md:text-base lg:pt-5 lg:text-lg dark:text-red-400"data-testid=error-message>');function Ze(e){return _(z,{get when(){return e.error},get children(){var t=x(Je);return w(t,()=>e.error),D(()=>j(t,"id",`${e.formName}-form-error`)),t}})}export{Xe as A,Ze as F,Qe as I,Pe as S,ae as a,Ke as b,He as c,Ye as h,Me as r};
